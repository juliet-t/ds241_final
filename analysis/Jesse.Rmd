---
title: "Jesse Analysis"
output: html_notebook
author: Jesse Dykes
---

Loading necessary packages

```{r}
library(knitr)
library(tidyverse)
library(janitor)
library(here) # more easily access files in your project
library(sf) # working with simple features - geospatial
library(tmap)
library(tidycensus)
library(matrixStats)
library(sp)
```
Knitr is used for properly transforming the r notebook into an html file.
The tidyverse is used to tidy data using other packages within in such as dplyr.
The janitor packages is used to clean up the variable names from the data sets.
The here library is used to locate files on the computer to make it easier to load in the data sets.
The sf library is used to work with spatial data.
The tmap library is used to create interaactive maps.
The tidycensus data is used to get data from the U.S Census Bureau data via codes. 


Load in Bikeshare system data and simplify the distance dataframe

```{r}
racks = st_read(here("data_raw", "Capital_Bikeshare_Locations.geojson")) |> clean_names()
racks = racks |> select(geometry,name)
```
Load DC data as spacial data and regular data for distance analysis

```{r}
dfShops = st_read(here("data_raw","Shopping_Centers.geojson")) |> clean_names()
pub_schools = st_read(here("data_raw", "DC_Public_Schools.geojson")) |> clean_names()
ind_schools = st_read(here("data_raw", "Independent_Schools.geojson")) |> clean_names()
```

Simplify shops and schools dataframes

```{r}
shops = dfShops |> select(geometry,name)
p_sch = pub_schools |> select(geometry,name)
i_sch = ind_schools |> select(geometry,name)
```

Api Key to access the census data

```{r}
census_api_key("9fc5d3792d3a5e922287c3f4e9995118766d50a2")
```
Load census data

```{r}
v2018 = load_variables(2018, "acs5")
```

Import specific census data:

Vehicles per neighborhood
Population per neighborhood
Amount of those that use public transportation per neighborhood

Filter for DC and keep neighborhood shapes
Filter for years 2017-2021

```{r}

df_cencus=get_acs(geography = "tract",
                  variables=c("vehicles"="B08141_001",
                              "population" = "B01001_001",
                              "public_transportion" = "B08006_008"),
                  state="DC",geometry=TRUE,year=2021) 
```

Clean census data
Add columns for ratios of: 
  vehicles to population
  public transport users to population
Adjust the spacial data for coordinate system 4326

```{r}
df_cens=df_cencus %>% 
  select(-moe) %>% 
  pivot_wider(names_from = "variable", 
              values_from = "estimate")

df_cens = df_cens |>
  mutate("v_to_p" = vehicles / population, "pub_transport_to_p" = public_transportion / population)

df_cens_adj = df_cens |> st_transform(4326)
```

Turn on the interactive map from tmap

Plot the modified census data
Plot the positions of:
  bikeshare stations (transparent teal)
  shopping areas (red)
  public schools (pink)
  independent schools (violet)

```{r}

tmap_mode("view")

tm_shape(df_cens) +tm_polygons(c("v_to_p", "pub_transport_to_p"), alpha=.5) + tm_shape(shops) + tm_dots(col = "#FF1300", size = 0.1) + tm_shape(racks) + tm_dots(col = "#AEEDE2", size = 0.06, alpha = 0.5) + tm_shape(p_sch) + tm_dots(col = "#FE2DE2", size = 0.06) + tm_shape(i_sch) + tm_dots(col = "#602DE2", size = 0.06)
```

Find the distance to the closest bikeshare station for each of the desired 
landmarks in meters

```{r}
crs <- CRS("+init=epsg:4326")

s_rack_d = st_distance(racks,shops)
isch_rack_d = st_distance(racks,i_sch)
psch_rack_d = st_distance(racks,p_sch)

```

```{r}
s_n = shops |> st_drop_geometry()
min_dist = colMins(s_rack_d)
srd_mins = cbind.data.frame(s_n,min_dist)
```

```{r}
p_n = p_sch |> st_drop_geometry()
min_dist = colMins(psch_rack_d)
prd_mins = cbind.data.frame(p_n,min_dist)
```

```{r}
i_n = i_sch |> st_drop_geometry()
min_dist = colMins(isch_rack_d)
ird_mins = cbind.data.frame(i_n,min_dist)
```


```{r}
allmins = rbind(srd_mins,ird_mins,prd_mins)


allmins |> ggplot(aes(x=min_dist)) + geom_histogram(binwidth = 100)

```

